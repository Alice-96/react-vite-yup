# Visual Regression Testing (VRT) ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Playwright + reg-suitã‚’ä½¿ç”¨ã—ã¦Visual Regression Testingï¼ˆãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆï¼‰ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](#ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [ãƒ†ã‚¹ãƒˆã®ç¨®é¡](#ãƒ†ã‚¹ãƒˆã®ç¨®é¡)
- [é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼](#é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼)
- [CI/CDã§ã®æ´»ç”¨](#cicdã§ã®æ´»ç”¨)
- [AWS S3çµ±åˆ](#aws-s3çµ±åˆ)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)

## æ¦‚è¦

### VRTã¨ã¯ï¼Ÿ

Visual Regression Testingï¼ˆVRTï¼‰ã¯ã€UIã®è¦‹ãŸç›®ã®å¤‰åŒ–ã‚’è‡ªå‹•çš„ã«æ¤œå‡ºã™ã‚‹ãƒ†ã‚¹ãƒˆæ‰‹æ³•ã§ã™ã€‚ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ãŒUIã«æ„å›³ã—ãªã„å½±éŸ¿ã‚’ä¸ãˆã¦ã„ãªã„ã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚

### ä½¿ç”¨æŠ€è¡“

- **Playwright**: E2Eãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ’®å½±ï¼‰
- **reg-suit**: ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ¤œå‡ºãƒ„ãƒ¼ãƒ«ï¼ˆå·®åˆ†æ¯”è¼ƒãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼‰
- **GitHub Actions**: CI/CDã§ã®è‡ªå‹•å®Ÿè¡Œ

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦ãªä¾å­˜é–¢ä¿‚

ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã™ï¼š

```json
{
  "@playwright/test": "^1.56.1",
  "playwright": "^1.56.1",
  "reg-suit": "^0.14.5",
  "reg-cli": "^0.18.10",
  "reg-keygen-git-hash-plugin": "^0.14.5",
  "reg-publish-gcs-plugin": "^0.14.4",
  "reg-notify-github-plugin": "^0.14.5",
  "storycap": "^5.0.1",
  "puppeteer": "^24.25.0"
}
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| `playwright.config.ts` | Playwrightã®è¨­å®šï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã€ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãªã©ï¼‰ |
| `regconfig.json` | reg-suitã®è¨­å®šï¼ˆé–¾å€¤ã€ä¿å­˜å ´æ‰€ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãªã©ï¼‰ |
| `vrt/helpers/screenshot.ts` | ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ’®å½±ç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° |
| `.github/workflows/vrt.yml` | GitHub Actionsã§ã®VRTå®Ÿè¡Œãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ |

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆåŸºæº–ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç”Ÿæˆï¼‰

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ç”Ÿæˆ
pnpm test:vrt:update
```

### 2. VRTãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# VRTãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦å·®åˆ†ã‚’ãƒã‚§ãƒƒã‚¯
pnpm test:vrt
```

### 3. UIãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆã‚’ãƒ‡ãƒãƒƒã‚°

```bash
# ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ†ã‚¹ãƒˆã®å®Ÿè¡ŒçŠ¶æ³ã‚’ç¢ºèª
pnpm test:vrt:ui
```

### 4. ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã®è¡¨ç¤º

```bash
# HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º
pnpm test:vrt:report
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|----------|------|
| `pnpm test:vrt` | VRTãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ |
| `pnpm test:vrt:update` | ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ›´æ–°ï¼ˆæ„å›³çš„ãªå¤‰æ›´å¾Œï¼‰ |
| `pnpm test:vrt:ui` | UIãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆãƒ‡ãƒãƒƒã‚°ã«ä¾¿åˆ©ï¼‰ |
| `pnpm test:vrt:report` | HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º |
| `pnpm vrt:reg` | reg-suitã§å·®åˆ†æ¤œå‡ºãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ |
| `pnpm vrt:capture` | ãƒ“ãƒ«ãƒ‰â†’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç”Ÿæˆã®ä¸€é€£ã®æµã‚Œã‚’å®Ÿè¡Œ |

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆ

```
vrt/
â”œâ”€â”€ helpers/
â”‚   â””â”€â”€ screenshot.ts              # ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ’®å½±ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”œâ”€â”€ home.spec.ts                   # ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®VRTãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ user-registration.spec.ts      # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒšãƒ¼ã‚¸ã®VRTãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ location-registration.spec.ts  # æ‹ ç‚¹ç™»éŒ²ãƒšãƒ¼ã‚¸ã®VRTãƒ†ã‚¹ãƒˆ
â””â”€â”€ user-list.spec.ts              # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãƒšãƒ¼ã‚¸ã®VRTãƒ†ã‚¹ãƒˆ
```

## ãƒ†ã‚¹ãƒˆã®ç¨®é¡

### 1. ãƒšãƒ¼ã‚¸å…¨ä½“ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ

å„ãƒšãƒ¼ã‚¸ã®å…¨ä½“çš„ãªå¤–è¦³ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```typescript
test('should render home page correctly', async ({ page }) => {
  await page.goto('/');
  await takeScreenshot(page, 'home-page');
});
```

### 2. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã®ãƒ†ã‚¹ãƒˆ

è¤‡æ•°ã®ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã‚µã‚¤ã‚ºã§ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±ã—ã¾ã™ã€‚

```typescript
test('should render home page responsively', async ({ page }) => {
  await takeResponsiveScreenshots(page, 'home-page', ['mobile', 'tablet', 'desktop']);
});
```

**å¯¾å¿œãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ:**
- **ãƒ¢ãƒã‚¤ãƒ«**: 375x667 (iPhone SE)
- **ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ**: 768x1024 (iPad)
- **ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—**: 1280x720
- **å¤§ç”»é¢**: 1920x1080

### 3. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ãƒ†ã‚¹ãƒˆ

UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å„çŠ¶æ…‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```typescript
test('should handle hover states correctly', async ({ page }) => {
  const button = page.locator('button').first();
  await button.hover();
  await takeScreenshot(page, 'home-page-hover');
});
```

**ãƒ†ã‚¹ãƒˆå¯¾è±¡:**
- ãƒ›ãƒãƒ¼çŠ¶æ…‹
- ãƒ•ã‚©ãƒ¼ã‚«ã‚¹çŠ¶æ…‹
- ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹

### 4. ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ†ã‚¹ãƒˆ

ãƒ•ã‚©ãƒ¼ãƒ é–¢é€£ã®ç‰¹åˆ¥ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¾ã™ã€‚

```typescript
test('should display form states correctly', async ({ page }) => {
  await takeFormStateScreenshots(page, 'form', 'registration-form');
});
```

**ãƒ†ã‚¹ãƒˆçŠ¶æ…‹:**
- åˆæœŸçŠ¶æ…‹
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ•ã‚©ãƒ¼ã‚«ã‚¹çŠ¶æ…‹
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹
- å…¥åŠ›æ¸ˆã¿çŠ¶æ…‹

### 5. ãƒãƒ«ãƒãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ

Chromiumã€Firefoxã€WebKitã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

**è¨­å®šæ¸ˆã¿ãƒ–ãƒ©ã‚¦ã‚¶:**
- Chrome (Chromium) - Desktop & Mobile
- Firefox
- Safari (WebKit)
- iPad Pro

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### æ–°æ©Ÿèƒ½é–‹ç™ºæ™‚

1. **é–‹ç™ºå‰**: ç¾åœ¨ã®UIã‚’ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨ã—ã¦ä¿å­˜

```bash
pnpm test:vrt:update
git add vrt/
git commit -m "Update VRT baselines before feature development"
```

2. **é–‹ç™ºä¸­**: å®šæœŸçš„ã«VRTãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
pnpm test:vrt
```

3. **å®Œäº†æ™‚**: æ„å›³çš„ãªå¤‰æ›´ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ›´æ–°

```bash
pnpm test:vrt:update
git add vrt/
git commit -m "Update VRT baselines after UI changes"
```

### Pull Requestæ™‚

1. **PRä½œæˆå‰**ã«VRTãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
pnpm test:vrt
```

2. **CI**ã§è‡ªå‹•çš„ã«VRTãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹

3. **å·®åˆ†ãŒã‚ã‚‹å ´åˆ**ã¯ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼ã¨ç¢ºèª
   - PRã‚³ãƒ¡ãƒ³ãƒˆã«å·®åˆ†ãƒ¬ãƒãƒ¼ãƒˆãŒè‡ªå‹•æŠ•ç¨¿ã•ã‚Œã‚‹
   - ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‹ã‚‰å·®åˆ†ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½

### ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å®Ÿè¡Œ

```bash
# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
npx playwright test home.spec.ts

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ›´æ–°
npx playwright test home.spec.ts --update-snapshots
```

## CI/CDã§ã®æ´»ç”¨

### GitHub Actions

`.github/workflows/vrt.yml`ã§PRæ™‚ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æµã‚Œ:**

1. ã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰
5. VRTãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
6. reg-suitã§ã®å·®åˆ†æ¤œå‡º
7. çµæœã®PRã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿
8. ãƒ†ã‚¹ãƒˆçµæœã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

**è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹PRã‚³ãƒ¡ãƒ³ãƒˆ:**

- âœ… ãƒ†ã‚¹ãƒˆçµæœã®ã‚µãƒãƒªãƒ¼
- ğŸ“Š å·®åˆ†ãŒã‚ã£ãŸå ´åˆã®è©³ç´°
- ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰
- ğŸ“¥ å·®åˆ†ç”»åƒã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯

## AWS S3çµ±åˆ

VRTãƒ¬ãƒãƒ¼ãƒˆã‚’AWS S3ã«ä¿å­˜ã—ã¦ã€PRã‚³ãƒ¡ãƒ³ãƒˆã‹ã‚‰ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

### ãƒ¡ãƒªãƒƒãƒˆ

- ğŸŒ **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¬ãƒãƒ¼ãƒˆ**: ãƒ–ãƒ©ã‚¦ã‚¶ã§å·®åˆ†ã‚’è¦–è¦šçš„ã«æ¯”è¼ƒ
- ğŸ“Š **å±¥æ­´ç®¡ç†**: éå»ã®VRTçµæœã‚’S3ã«ä¿å­˜
- ğŸ”— **ç°¡å˜ãªå…±æœ‰**: URLã§ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨å…±æœ‰
- ğŸ’¾ **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç¯€ç´„**: Gitãƒªãƒã‚¸ãƒˆãƒªã«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å«ã‚ãªã„

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã¯ **[VRT_S3_SETUP.md](./VRT_S3_SETUP.md)** ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**æ¦‚è¦:**
1. AWS S3ãƒã‚±ãƒƒãƒˆã®ä½œæˆ
2. IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã¨ãƒãƒªã‚·ãƒ¼è¨­å®š
3. GitHub Secretsã®è¨­å®š
   - `AWS_ACCESS_KEY_ID`
   - `AWS_SECRET_ACCESS_KEY`
   - `AWS_REGION`
   - `S3_BUCKET_NAME`
4. å‹•ä½œç¢ºèª

### ä½¿ç”¨æ–¹æ³•

S3ãŒè¨­å®šã•ã‚Œã‚‹ã¨ã€PRä½œæˆæ™‚ã«è‡ªå‹•çš„ã«ï¼š
1. reg-suitãŒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¨å·®åˆ†ãƒ¬ãƒãƒ¼ãƒˆã‚’S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
2. S3ä¸Šã®ãƒ¬ãƒãƒ¼ãƒˆURLãŒPRã‚³ãƒ¡ãƒ³ãƒˆã«æŠ•ç¨¿ã•ã‚Œã‚‹
3. ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼ãŒãƒ–ãƒ©ã‚¦ã‚¶ã§å·®åˆ†ã‚’ç¢ºèªã§ãã‚‹

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®å·®åˆ†ãŒç™ºç”Ÿã™ã‚‹

**åŸå› :**
- ãƒ•ã‚©ãƒ³ãƒˆã®é•ã„ï¼ˆOSé–“ï¼‰
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ç„¡åŠ¹åŒ–ä¸è¶³
- å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆæ™‚é–“ã€ãƒ©ãƒ³ãƒ€ãƒ ãƒ‡ãƒ¼ã‚¿ï¼‰
- ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®é•ã„

**å¯¾å‡¦æ³•:**

```bash
# å·®åˆ†ã‚’ç¢ºèª
pnpm test:vrt:ui

# æ„å›³çš„ãªå¤‰æ›´ã®å ´åˆã¯ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’æ›´æ–°
pnpm test:vrt:update

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿æ›´æ–°
npx playwright test home.spec.ts --update-snapshots
```

#### 2. ãƒ†ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹

**å¯¾å‡¦æ³•:**
- `playwright.config.ts`ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã‚’ç¢ºèª
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®çŠ¶æ…‹ã‚’ç¢ºèªï¼ˆ`networkidle`ã®å¾…æ©Ÿï¼‰

```typescript
// ãƒ†ã‚¹ãƒˆå†…ã§å¾…æ©Ÿæ™‚é–“ã‚’èª¿æ•´
await page.waitForLoadState('networkidle');
await page.waitForTimeout(500);
```

#### 3. ãƒ–ãƒ©ã‚¦ã‚¶ãŒèµ·å‹•ã—ãªã„

**å¯¾å‡¦æ³•:**

```bash
# Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã®å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npx playwright install --with-deps
```

#### 4. CIã¨ãƒ­ãƒ¼ã‚«ãƒ«ã§å·®åˆ†ãŒå‡ºã‚‹

**åŸå› :**
- ãƒ•ã‚©ãƒ³ãƒˆã®é•ã„
- OSå›ºæœ‰ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å·®ç•°

**å¯¾å‡¦æ³•:**
- CIç’°å¢ƒã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã—ç›´ã™
- `playwright.config.ts`ã§é–¾å€¤ã‚’èª¿æ•´

```typescript
expect: {
  toHaveScreenshot: {
    threshold: 0.2,  // é–¾å€¤ã‚’èª¿æ•´
    maxDiffPixels: 100,
  },
}
```

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

#### UIãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨

```bash
pnpm test:vrt:ui
```

- ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
- ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ‡ãƒãƒƒã‚°
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèª

#### ãƒˆãƒ¬ãƒ¼ã‚¹æ©Ÿèƒ½

å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ç¢ºèª:

```bash
# ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã‚’é–‹ã
npx playwright show-trace test-results/.../trace.zip
```

#### ã‚ˆã‚Šç¢ºå®Ÿãªå¾…æ©Ÿ

```typescript
// ç‰¹å®šã®è¦ç´ ã®è¡¨ç¤ºå¾…ã¡
await page.waitForSelector('[data-testid="component"]');

// ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒå®‰å®šã™ã‚‹ã¾ã§å¾…æ©Ÿ
await page.waitForLoadState('networkidle');

// æ˜ç¤ºçš„ãªå¾…æ©Ÿï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰
await page.waitForTimeout(500);
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ä¸€è²«ã—ãŸç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

- åŒã˜OSã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨
- CIç’°å¢ƒã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ
- ãƒ•ã‚©ãƒ³ãƒˆã®çµ±ä¸€

### 2. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ç„¡åŠ¹åŒ–

```typescript
// ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã§è‡ªå‹•çš„ã«ç„¡åŠ¹åŒ–
await takeScreenshot(page, 'page-name');

// ã¾ãŸã¯æ‰‹å‹•ã§ç„¡åŠ¹åŒ–
await page.addStyleTag({
  content: `
    *, *::before, *::after {
      animation-duration: 0s !important;
      transition-duration: 0s !important;
    }
  `
});
```

### 3. å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å¯¾ç­–

- ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®ä½¿ç”¨
- å›ºå®šã®æ™‚åˆ»ãƒ»æ—¥ä»˜
- ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ã®é™¤å¤–

```typescript
// MSWã§ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
await page.route('**/api/users', route => {
  route.fulfill({
    status: 200,
    body: JSON.stringify(mockUsers)
  });
});
```

### 4. é©åˆ‡ãªç²’åº¦ã§ãƒ†ã‚¹ãƒˆ

- ãƒšãƒ¼ã‚¸å…¨ä½“ã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå˜ä½ã®ä¸¡æ–¹
- é‡è¦ãªã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åŒ…æ‹¬
- éåº¦ã«ç´°ã‹ã„ãƒ†ã‚¹ãƒˆã¯é¿ã‘ã‚‹

### 5. å®šæœŸçš„ãªãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ›´æ–°

- æ„å›³çš„ãªãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´å¾Œã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ›´æ–°
- ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã§ã®æ‰¿èª
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã®è¿½è·¡

### 6. ãƒ†ã‚¹ãƒˆã®å®‰å®šæ€§å‘ä¸Š

```typescript
// ãƒšãƒ¼ã‚¸ãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
await page.waitForLoadState('networkidle');

// çŸ­æ™‚é–“å¾…æ©Ÿã—ã¦ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œã‚‹ã®ã‚’ç¢ºä¿
await page.waitForTimeout(100);

// ç‰¹å®šã®è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å¾…æ©Ÿ
await page.waitForSelector('[data-testid="component"]', {
  state: 'visible',
  timeout: 10000
});
```

## ãƒ†ã‚¹ãƒˆå¯¾è±¡ãƒšãƒ¼ã‚¸

| ãƒšãƒ¼ã‚¸ | URL | ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« | ãƒ†ã‚¹ãƒˆå†…å®¹ |
|--------|-----|----------------|-----------|
| ãƒ›ãƒ¼ãƒ  | `/` | `home.spec.ts` | åŸºæœ¬è¡¨ç¤ºã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã€ãƒ›ãƒãƒ¼/ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ² | `/user-registration` | `user-registration.spec.ts` | ãƒ•ã‚©ãƒ¼ãƒ å„çŠ¶æ…‹ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€å…¥åŠ›æ¸ˆã¿çŠ¶æ…‹ |
| æ‹ ç‚¹ç™»éŒ² | `/location-registration` | `location-registration.spec.ts` | ãƒ•ã‚©ãƒ¼ãƒ ã€ã‚»ãƒ¬ã‚¯ãƒˆã€æ¡ä»¶ä»˜ããƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ | `/user-list` | `user-list.spec.ts` | ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ |

## ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°

### `takeScreenshot(page, name, options)`

åŸºæœ¬çš„ãªã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ’®å½±

```typescript
await takeScreenshot(page, 'page-name');
```

### `takeComponentScreenshot(page, selector, name, options)`

ç‰¹å®šã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ

```typescript
await takeComponentScreenshot(page, '.my-component', 'component-name');
```

### `takeFormStateScreenshots(page, formSelector, testName)`

ãƒ•ã‚©ãƒ¼ãƒ ã®å„çŠ¶æ…‹ã‚’è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆ

```typescript
await takeFormStateScreenshots(page, 'form', 'registration-form');
```

### `takeResponsiveScreenshots(page, name, viewportSizes)`

ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã®ãƒ†ã‚¹ãƒˆ

```typescript
await takeResponsiveScreenshots(page, 'page-name', ['mobile', 'tablet', 'desktop']);
```

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### æ–°ã—ã„ãƒšãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 

1. `vrt/` ãƒ•ã‚©ãƒ«ãƒ€ã« `new-page.spec.ts` ã‚’ä½œæˆ

```typescript
import { test } from '@playwright/test';
import { takeScreenshot } from './helpers/screenshot';

test.describe('NewPage Visual Tests', () => {
  test('should render new page correctly', async ({ page }) => {
    await page.goto('/new-page');
    await takeScreenshot(page, 'new-page');
  });
});
```

2. åˆå›å®Ÿè¡Œã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆ

```bash
pnpm test:vrt:update
```

### ãƒ†ã‚¹ãƒˆè¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

**`playwright.config.ts`:**
- ãƒ–ãƒ©ã‚¦ã‚¶ã®é¸æŠ
- ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã‚µã‚¤ã‚º
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
- ä¸¦åˆ—å®Ÿè¡Œæ•°

**`regconfig.json`:**
- å·®åˆ†ã®é–¾å€¤ï¼ˆthresholdï¼‰
- å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®š

**`vrt/helpers/screenshot.ts`:**
- å…±é€šæ©Ÿèƒ½ã®è¿½åŠ 
- ã‚«ã‚¹ã‚¿ãƒ ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°

## å‚è€ƒè³‡æ–™

- [Playwright Documentation](https://playwright.dev/)
- [reg-suit Documentation](https://reg-viz.github.io/reg-suit/)
- [Visual Testing Best Practices](https://playwright.dev/docs/test-snapshots)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)

## ã¾ã¨ã‚

VRTã¯ã€UIã®å“è³ªã‚’ä¿ã¤ãŸã‚ã®å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦ã€åŠ¹æœçš„ãªãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã—ã€UIå¤‰æ›´ã®å½±éŸ¿ã‚’æ—©æœŸã«æ¤œå‡ºã—ã¾ã—ã‚‡ã†ã€‚

è³ªå•ã‚„å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Issueãƒˆãƒ©ãƒƒã‚«ãƒ¼ã§å ±å‘Šã—ã¦ãã ã•ã„ã€‚
